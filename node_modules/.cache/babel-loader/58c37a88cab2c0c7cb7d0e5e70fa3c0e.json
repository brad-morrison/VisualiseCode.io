{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.mask = mask;\n\nvar _DomHandler = _interopRequireDefault(require(\"./DomHandler\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction mask(el, options) {\n  var defaultOptions = {\n    mask: null,\n    slotChar: '_',\n    autoClear: true,\n    unmask: false,\n    readOnly: false,\n    onComplete: null,\n    onChange: null,\n    onFocus: null,\n    onBlur: null\n  };\n  options = _objectSpread(_objectSpread({}, defaultOptions), options);\n  var tests, partialPosition, len, firstNonMaskPos, defs, androidChrome, lastRequiredNonMaskPos, oldVal, focusText, caretTimeoutId, buffer, defaultBuffer;\n\n  var caret = function caret(first, last) {\n    var range, begin, end;\n\n    if (!el.offsetParent || el !== document.activeElement) {\n      return;\n    }\n\n    if (typeof first === 'number') {\n      begin = first;\n      end = typeof last === 'number' ? last : begin;\n\n      if (el.setSelectionRange) {\n        el.setSelectionRange(begin, end);\n      } else if (el['createTextRange']) {\n        range = el['createTextRange']();\n        range.collapse(true);\n        range.moveEnd('character', end);\n        range.moveStart('character', begin);\n        range.select();\n      }\n    } else {\n      if (el.setSelectionRange) {\n        begin = el.selectionStart;\n        end = el.selectionEnd;\n      } else if (document['selection'] && document['selection'].createRange) {\n        range = document['selection'].createRange();\n        begin = 0 - range.duplicate().moveStart('character', -100000);\n        end = begin + range.text.length;\n      }\n\n      return {\n        begin: begin,\n        end: end\n      };\n    }\n  };\n\n  var isCompleted = function isCompleted() {\n    for (var i = firstNonMaskPos; i <= lastRequiredNonMaskPos; i++) {\n      if (tests[i] && buffer[i] === getPlaceholder(i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var getPlaceholder = function getPlaceholder(i) {\n    if (i < options.slotChar.length) {\n      return options.slotChar.charAt(i);\n    }\n\n    return options.slotChar.charAt(0);\n  };\n\n  var getValue = function getValue() {\n    return options.unmask ? getUnmaskedValue() : el && el.value;\n  };\n\n  var seekNext = function seekNext(pos) {\n    while (++pos < len && !tests[pos]) {\n      ;\n    }\n\n    return pos;\n  };\n\n  var seekPrev = function seekPrev(pos) {\n    while (--pos >= 0 && !tests[pos]) {\n      ;\n    }\n\n    return pos;\n  };\n\n  var shiftL = function shiftL(begin, end) {\n    var i, j;\n\n    if (begin < 0) {\n      return;\n    }\n\n    for (i = begin, j = seekNext(end); i < len; i++) {\n      if (tests[i]) {\n        if (j < len && tests[i].test(buffer[j])) {\n          buffer[i] = buffer[j];\n          buffer[j] = getPlaceholder(j);\n        } else {\n          break;\n        }\n\n        j = seekNext(j);\n      }\n    }\n\n    writeBuffer();\n    caret(Math.max(firstNonMaskPos, begin));\n  };\n\n  var shiftR = function shiftR(pos) {\n    var i, c, j, t;\n\n    for (i = pos, c = getPlaceholder(pos); i < len; i++) {\n      if (tests[i]) {\n        j = seekNext(i);\n        t = buffer[i];\n        buffer[i] = c;\n\n        if (j < len && tests[j].test(t)) {\n          c = t;\n        } else {\n          break;\n        }\n      }\n    }\n  };\n\n  var handleAndroidInput = function handleAndroidInput(e) {\n    var curVal = el.value;\n    var pos = caret();\n\n    if (oldVal && oldVal.length && oldVal.length > curVal.length) {\n      // a deletion or backspace happened\n      checkVal(true);\n\n      while (pos.begin > 0 && !tests[pos.begin - 1]) {\n        pos.begin--;\n      }\n\n      if (pos.begin === 0) {\n        while (pos.begin < firstNonMaskPos && !tests[pos.begin]) {\n          pos.begin++;\n        }\n      }\n\n      caret(pos.begin, pos.begin);\n    } else {\n      checkVal(true);\n\n      while (pos.begin < len && !tests[pos.begin]) {\n        pos.begin++;\n      }\n\n      caret(pos.begin, pos.begin);\n    }\n\n    if (options.onComplete && isCompleted()) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var onBlur = function onBlur(e) {\n    checkVal();\n    updateModel(e);\n\n    if (options.onBlur) {\n      options.onBlur(e);\n    }\n\n    if (el.value !== focusText) {\n      var event = document.createEvent('HTMLEvents');\n      event.initEvent('change', true, false);\n      el.dispatchEvent(event);\n    }\n  };\n\n  var onKeyDown = function onKeyDown(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var k = e.which || e.keyCode,\n        pos,\n        begin,\n        end;\n    var iPhone = /iphone/i.test(_DomHandler.default.getUserAgent());\n    oldVal = el.value; //backspace, delete, and escape get special treatment\n\n    if (k === 8 || k === 46 || iPhone && k === 127) {\n      pos = caret();\n      begin = pos.begin;\n      end = pos.end;\n\n      if (end - begin === 0) {\n        begin = k !== 46 ? seekPrev(begin) : end = seekNext(begin - 1);\n        end = k === 46 ? seekNext(end) : end;\n      }\n\n      clearBuffer(begin, end);\n      shiftL(begin, end - 1);\n      updateModel(e);\n      e.preventDefault();\n    } else if (k === 13) {\n      // enter\n      onBlur(e);\n      updateModel(e);\n    } else if (k === 27) {\n      // escape\n      el.value = focusText;\n      caret(0, checkVal());\n      updateModel(e);\n      e.preventDefault();\n    }\n  };\n\n  var onKeyPress = function onKeyPress(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var k = e.which || e.keyCode,\n        pos = caret(),\n        p,\n        c,\n        next,\n        completed;\n\n    if (e.ctrlKey || e.altKey || e.metaKey || k < 32) {\n      //Ignore\n      return;\n    } else if (k && k !== 13) {\n      if (pos.end - pos.begin !== 0) {\n        clearBuffer(pos.begin, pos.end);\n        shiftL(pos.begin, pos.end - 1);\n      }\n\n      p = seekNext(pos.begin - 1);\n\n      if (p < len) {\n        c = String.fromCharCode(k);\n\n        if (tests[p].test(c)) {\n          shiftR(p);\n          buffer[p] = c;\n          writeBuffer();\n          next = seekNext(p);\n\n          if (/android/i.test(_DomHandler.default.getUserAgent())) {\n            //Path for CSP Violation on FireFox OS 1.1\n            var proxy = function proxy() {\n              caret(next);\n            };\n\n            setTimeout(proxy, 0);\n          } else {\n            caret(next);\n          }\n\n          if (pos.begin <= lastRequiredNonMaskPos) {\n            completed = isCompleted();\n          }\n        }\n      }\n\n      e.preventDefault();\n    }\n\n    updateModel(e);\n\n    if (options.onComplete && completed) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var clearBuffer = function clearBuffer(start, end) {\n    var i;\n\n    for (i = start; i < end && i < len; i++) {\n      if (tests[i]) {\n        buffer[i] = getPlaceholder(i);\n      }\n    }\n  };\n\n  var writeBuffer = function writeBuffer() {\n    el.value = buffer.join('');\n  };\n\n  var checkVal = function checkVal(allow) {\n    //try to place characters where they belong\n    var test = el.value,\n        lastMatch = -1,\n        i,\n        c,\n        pos;\n\n    for (i = 0, pos = 0; i < len; i++) {\n      if (tests[i]) {\n        buffer[i] = getPlaceholder(i);\n\n        while (pos++ < test.length) {\n          c = test.charAt(pos - 1);\n\n          if (tests[i].test(c)) {\n            buffer[i] = c;\n            lastMatch = i;\n            break;\n          }\n        }\n\n        if (pos > test.length) {\n          clearBuffer(i + 1, len);\n          break;\n        }\n      } else {\n        if (buffer[i] === test.charAt(pos)) {\n          pos++;\n        }\n\n        if (i < partialPosition) {\n          lastMatch = i;\n        }\n      }\n    }\n\n    if (allow) {\n      writeBuffer();\n    } else if (lastMatch + 1 < partialPosition) {\n      if (options.autoClear || buffer.join('') === defaultBuffer) {\n        // Invalid value. Remove it and replace it with the\n        // mask, which is the default behavior.\n        if (el.value) el.value = '';\n        clearBuffer(0, len);\n      } else {\n        // Invalid value, but we opt to show the value to the\n        // user and allow them to correct their mistake.\n        writeBuffer();\n      }\n    } else {\n      writeBuffer();\n      el.value = el.value.substring(0, lastMatch + 1);\n    }\n\n    return partialPosition ? i : firstNonMaskPos;\n  };\n\n  var onFocus = function onFocus(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    clearTimeout(caretTimeoutId);\n    var pos;\n    focusText = el.value;\n    pos = checkVal();\n    caretTimeoutId = setTimeout(function () {\n      if (el !== document.activeElement) {\n        return;\n      }\n\n      writeBuffer();\n\n      if (pos === options.mask.replace(\"?\", \"\").length) {\n        caret(0, pos);\n      } else {\n        caret(pos);\n      }\n    }, 10);\n\n    if (options.onFocus) {\n      options.onFocus(e);\n    }\n  };\n\n  var onInput = function onInput(event) {\n    if (androidChrome) handleAndroidInput(event);else handleInputChange(event);\n  };\n\n  var handleInputChange = function handleInputChange(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var pos = checkVal(true);\n    caret(pos);\n    updateModel(e);\n\n    if (options.onComplete && isCompleted()) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var getUnmaskedValue = function getUnmaskedValue() {\n    var unmaskedBuffer = [];\n\n    for (var i = 0; i < buffer.length; i++) {\n      var c = buffer[i];\n\n      if (tests[i] && c !== getPlaceholder(i)) {\n        unmaskedBuffer.push(c);\n      }\n    }\n\n    return unmaskedBuffer.join('');\n  };\n\n  var updateModel = function updateModel(e) {\n    if (options.onChange) {\n      var val = getValue().replace(options.slotChar, '');\n      options.onChange({\n        originalEvent: e,\n        value: defaultBuffer !== val ? val : ''\n      });\n    }\n  };\n\n  var bindEvents = function bindEvents() {\n    el.addEventListener('focus', onFocus);\n    el.addEventListener('blur', onBlur);\n    el.addEventListener('keydown', onKeyDown);\n    el.addEventListener('keypress', onKeyPress);\n    el.addEventListener('input', onInput);\n    el.addEventListener('paste', handleInputChange);\n  };\n\n  var unbindEvents = function unbindEvents() {\n    el.removeEventListener('focus', onFocus);\n    el.removeEventListener('blur', onBlur);\n    el.removeEventListener('keydown', onKeyDown);\n    el.removeEventListener('keypress', onKeyPress);\n    el.removeEventListener('input', onInput);\n    el.removeEventListener('paste', handleInputChange);\n  };\n\n  var init = function init() {\n    tests = [];\n    partialPosition = options.mask.length;\n    len = options.mask.length;\n    firstNonMaskPos = null;\n    defs = {\n      '9': '[0-9]',\n      'a': '[A-Za-z]',\n      '*': '[A-Za-z0-9]'\n    };\n\n    var ua = _DomHandler.default.getUserAgent();\n\n    androidChrome = /chrome/i.test(ua) && /android/i.test(ua);\n    var maskTokens = options.mask.split('');\n\n    for (var i = 0; i < maskTokens.length; i++) {\n      var c = maskTokens[i];\n\n      if (c === '?') {\n        len--;\n        partialPosition = i;\n      } else if (defs[c]) {\n        tests.push(new RegExp(defs[c]));\n\n        if (firstNonMaskPos === null) {\n          firstNonMaskPos = tests.length - 1;\n        }\n\n        if (i < partialPosition) {\n          lastRequiredNonMaskPos = tests.length - 1;\n        }\n      } else {\n        tests.push(null);\n      }\n    }\n\n    buffer = [];\n\n    for (var _i = 0; _i < maskTokens.length; _i++) {\n      var _c = maskTokens[_i];\n\n      if (_c !== '?') {\n        if (defs[_c]) buffer.push(getPlaceholder(_i));else buffer.push(_c);\n      }\n    }\n\n    defaultBuffer = buffer.join('');\n  };\n\n  if (el && options.mask) {\n    init();\n    bindEvents();\n  }\n\n  return {\n    init: init,\n    bindEvents: bindEvents,\n    unbindEvents: unbindEvents,\n    updateModel: updateModel,\n    getValue: getValue\n  };\n}","map":{"version":3,"sources":["/Users/brad/Documents/GitHub/MScProject/node_modules/primereact/components/utils/Mask.js"],"names":["Object","defineProperty","exports","value","mask","_DomHandler","_interopRequireDefault","require","obj","__esModule","default","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","el","options","defaultOptions","slotChar","autoClear","unmask","readOnly","onComplete","onChange","onFocus","onBlur","tests","partialPosition","len","firstNonMaskPos","defs","androidChrome","lastRequiredNonMaskPos","oldVal","focusText","caretTimeoutId","buffer","defaultBuffer","caret","first","last","range","begin","end","offsetParent","document","activeElement","setSelectionRange","collapse","moveEnd","moveStart","select","selectionStart","selectionEnd","createRange","duplicate","text","isCompleted","getPlaceholder","charAt","getValue","getUnmaskedValue","seekNext","pos","seekPrev","shiftL","j","test","writeBuffer","Math","max","shiftR","c","t","handleAndroidInput","e","curVal","checkVal","originalEvent","updateModel","event","createEvent","initEvent","dispatchEvent","onKeyDown","k","which","keyCode","iPhone","getUserAgent","clearBuffer","preventDefault","onKeyPress","p","next","completed","ctrlKey","altKey","metaKey","String","fromCharCode","proxy","setTimeout","start","join","allow","lastMatch","substring","clearTimeout","replace","onInput","handleInputChange","unmaskedBuffer","val","bindEvents","addEventListener","unbindEvents","removeEventListener","init","ua","maskTokens","split","RegExp","_i","_c"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.mask = mask;\n\nvar _DomHandler = _interopRequireDefault(require(\"./DomHandler\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction mask(el, options) {\n  var defaultOptions = {\n    mask: null,\n    slotChar: '_',\n    autoClear: true,\n    unmask: false,\n    readOnly: false,\n    onComplete: null,\n    onChange: null,\n    onFocus: null,\n    onBlur: null\n  };\n  options = _objectSpread(_objectSpread({}, defaultOptions), options);\n  var tests, partialPosition, len, firstNonMaskPos, defs, androidChrome, lastRequiredNonMaskPos, oldVal, focusText, caretTimeoutId, buffer, defaultBuffer;\n\n  var caret = function caret(first, last) {\n    var range, begin, end;\n\n    if (!el.offsetParent || el !== document.activeElement) {\n      return;\n    }\n\n    if (typeof first === 'number') {\n      begin = first;\n      end = typeof last === 'number' ? last : begin;\n\n      if (el.setSelectionRange) {\n        el.setSelectionRange(begin, end);\n      } else if (el['createTextRange']) {\n        range = el['createTextRange']();\n        range.collapse(true);\n        range.moveEnd('character', end);\n        range.moveStart('character', begin);\n        range.select();\n      }\n    } else {\n      if (el.setSelectionRange) {\n        begin = el.selectionStart;\n        end = el.selectionEnd;\n      } else if (document['selection'] && document['selection'].createRange) {\n        range = document['selection'].createRange();\n        begin = 0 - range.duplicate().moveStart('character', -100000);\n        end = begin + range.text.length;\n      }\n\n      return {\n        begin: begin,\n        end: end\n      };\n    }\n  };\n\n  var isCompleted = function isCompleted() {\n    for (var i = firstNonMaskPos; i <= lastRequiredNonMaskPos; i++) {\n      if (tests[i] && buffer[i] === getPlaceholder(i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  var getPlaceholder = function getPlaceholder(i) {\n    if (i < options.slotChar.length) {\n      return options.slotChar.charAt(i);\n    }\n\n    return options.slotChar.charAt(0);\n  };\n\n  var getValue = function getValue() {\n    return options.unmask ? getUnmaskedValue() : el && el.value;\n  };\n\n  var seekNext = function seekNext(pos) {\n    while (++pos < len && !tests[pos]) {\n      ;\n    }\n\n    return pos;\n  };\n\n  var seekPrev = function seekPrev(pos) {\n    while (--pos >= 0 && !tests[pos]) {\n      ;\n    }\n\n    return pos;\n  };\n\n  var shiftL = function shiftL(begin, end) {\n    var i, j;\n\n    if (begin < 0) {\n      return;\n    }\n\n    for (i = begin, j = seekNext(end); i < len; i++) {\n      if (tests[i]) {\n        if (j < len && tests[i].test(buffer[j])) {\n          buffer[i] = buffer[j];\n          buffer[j] = getPlaceholder(j);\n        } else {\n          break;\n        }\n\n        j = seekNext(j);\n      }\n    }\n\n    writeBuffer();\n    caret(Math.max(firstNonMaskPos, begin));\n  };\n\n  var shiftR = function shiftR(pos) {\n    var i, c, j, t;\n\n    for (i = pos, c = getPlaceholder(pos); i < len; i++) {\n      if (tests[i]) {\n        j = seekNext(i);\n        t = buffer[i];\n        buffer[i] = c;\n\n        if (j < len && tests[j].test(t)) {\n          c = t;\n        } else {\n          break;\n        }\n      }\n    }\n  };\n\n  var handleAndroidInput = function handleAndroidInput(e) {\n    var curVal = el.value;\n    var pos = caret();\n\n    if (oldVal && oldVal.length && oldVal.length > curVal.length) {\n      // a deletion or backspace happened\n      checkVal(true);\n\n      while (pos.begin > 0 && !tests[pos.begin - 1]) {\n        pos.begin--;\n      }\n\n      if (pos.begin === 0) {\n        while (pos.begin < firstNonMaskPos && !tests[pos.begin]) {\n          pos.begin++;\n        }\n      }\n\n      caret(pos.begin, pos.begin);\n    } else {\n      checkVal(true);\n\n      while (pos.begin < len && !tests[pos.begin]) {\n        pos.begin++;\n      }\n\n      caret(pos.begin, pos.begin);\n    }\n\n    if (options.onComplete && isCompleted()) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var onBlur = function onBlur(e) {\n    checkVal();\n    updateModel(e);\n\n    if (options.onBlur) {\n      options.onBlur(e);\n    }\n\n    if (el.value !== focusText) {\n      var event = document.createEvent('HTMLEvents');\n      event.initEvent('change', true, false);\n      el.dispatchEvent(event);\n    }\n  };\n\n  var onKeyDown = function onKeyDown(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var k = e.which || e.keyCode,\n        pos,\n        begin,\n        end;\n    var iPhone = /iphone/i.test(_DomHandler.default.getUserAgent());\n    oldVal = el.value; //backspace, delete, and escape get special treatment\n\n    if (k === 8 || k === 46 || iPhone && k === 127) {\n      pos = caret();\n      begin = pos.begin;\n      end = pos.end;\n\n      if (end - begin === 0) {\n        begin = k !== 46 ? seekPrev(begin) : end = seekNext(begin - 1);\n        end = k === 46 ? seekNext(end) : end;\n      }\n\n      clearBuffer(begin, end);\n      shiftL(begin, end - 1);\n      updateModel(e);\n      e.preventDefault();\n    } else if (k === 13) {\n      // enter\n      onBlur(e);\n      updateModel(e);\n    } else if (k === 27) {\n      // escape\n      el.value = focusText;\n      caret(0, checkVal());\n      updateModel(e);\n      e.preventDefault();\n    }\n  };\n\n  var onKeyPress = function onKeyPress(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var k = e.which || e.keyCode,\n        pos = caret(),\n        p,\n        c,\n        next,\n        completed;\n\n    if (e.ctrlKey || e.altKey || e.metaKey || k < 32) {\n      //Ignore\n      return;\n    } else if (k && k !== 13) {\n      if (pos.end - pos.begin !== 0) {\n        clearBuffer(pos.begin, pos.end);\n        shiftL(pos.begin, pos.end - 1);\n      }\n\n      p = seekNext(pos.begin - 1);\n\n      if (p < len) {\n        c = String.fromCharCode(k);\n\n        if (tests[p].test(c)) {\n          shiftR(p);\n          buffer[p] = c;\n          writeBuffer();\n          next = seekNext(p);\n\n          if (/android/i.test(_DomHandler.default.getUserAgent())) {\n            //Path for CSP Violation on FireFox OS 1.1\n            var proxy = function proxy() {\n              caret(next);\n            };\n\n            setTimeout(proxy, 0);\n          } else {\n            caret(next);\n          }\n\n          if (pos.begin <= lastRequiredNonMaskPos) {\n            completed = isCompleted();\n          }\n        }\n      }\n\n      e.preventDefault();\n    }\n\n    updateModel(e);\n\n    if (options.onComplete && completed) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var clearBuffer = function clearBuffer(start, end) {\n    var i;\n\n    for (i = start; i < end && i < len; i++) {\n      if (tests[i]) {\n        buffer[i] = getPlaceholder(i);\n      }\n    }\n  };\n\n  var writeBuffer = function writeBuffer() {\n    el.value = buffer.join('');\n  };\n\n  var checkVal = function checkVal(allow) {\n    //try to place characters where they belong\n    var test = el.value,\n        lastMatch = -1,\n        i,\n        c,\n        pos;\n\n    for (i = 0, pos = 0; i < len; i++) {\n      if (tests[i]) {\n        buffer[i] = getPlaceholder(i);\n\n        while (pos++ < test.length) {\n          c = test.charAt(pos - 1);\n\n          if (tests[i].test(c)) {\n            buffer[i] = c;\n            lastMatch = i;\n            break;\n          }\n        }\n\n        if (pos > test.length) {\n          clearBuffer(i + 1, len);\n          break;\n        }\n      } else {\n        if (buffer[i] === test.charAt(pos)) {\n          pos++;\n        }\n\n        if (i < partialPosition) {\n          lastMatch = i;\n        }\n      }\n    }\n\n    if (allow) {\n      writeBuffer();\n    } else if (lastMatch + 1 < partialPosition) {\n      if (options.autoClear || buffer.join('') === defaultBuffer) {\n        // Invalid value. Remove it and replace it with the\n        // mask, which is the default behavior.\n        if (el.value) el.value = '';\n        clearBuffer(0, len);\n      } else {\n        // Invalid value, but we opt to show the value to the\n        // user and allow them to correct their mistake.\n        writeBuffer();\n      }\n    } else {\n      writeBuffer();\n      el.value = el.value.substring(0, lastMatch + 1);\n    }\n\n    return partialPosition ? i : firstNonMaskPos;\n  };\n\n  var onFocus = function onFocus(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    clearTimeout(caretTimeoutId);\n    var pos;\n    focusText = el.value;\n    pos = checkVal();\n    caretTimeoutId = setTimeout(function () {\n      if (el !== document.activeElement) {\n        return;\n      }\n\n      writeBuffer();\n\n      if (pos === options.mask.replace(\"?\", \"\").length) {\n        caret(0, pos);\n      } else {\n        caret(pos);\n      }\n    }, 10);\n\n    if (options.onFocus) {\n      options.onFocus(e);\n    }\n  };\n\n  var onInput = function onInput(event) {\n    if (androidChrome) handleAndroidInput(event);else handleInputChange(event);\n  };\n\n  var handleInputChange = function handleInputChange(e) {\n    if (options.readOnly) {\n      return;\n    }\n\n    var pos = checkVal(true);\n    caret(pos);\n    updateModel(e);\n\n    if (options.onComplete && isCompleted()) {\n      options.onComplete({\n        originalEvent: e,\n        value: getValue()\n      });\n    }\n  };\n\n  var getUnmaskedValue = function getUnmaskedValue() {\n    var unmaskedBuffer = [];\n\n    for (var i = 0; i < buffer.length; i++) {\n      var c = buffer[i];\n\n      if (tests[i] && c !== getPlaceholder(i)) {\n        unmaskedBuffer.push(c);\n      }\n    }\n\n    return unmaskedBuffer.join('');\n  };\n\n  var updateModel = function updateModel(e) {\n    if (options.onChange) {\n      var val = getValue().replace(options.slotChar, '');\n      options.onChange({\n        originalEvent: e,\n        value: defaultBuffer !== val ? val : ''\n      });\n    }\n  };\n\n  var bindEvents = function bindEvents() {\n    el.addEventListener('focus', onFocus);\n    el.addEventListener('blur', onBlur);\n    el.addEventListener('keydown', onKeyDown);\n    el.addEventListener('keypress', onKeyPress);\n    el.addEventListener('input', onInput);\n    el.addEventListener('paste', handleInputChange);\n  };\n\n  var unbindEvents = function unbindEvents() {\n    el.removeEventListener('focus', onFocus);\n    el.removeEventListener('blur', onBlur);\n    el.removeEventListener('keydown', onKeyDown);\n    el.removeEventListener('keypress', onKeyPress);\n    el.removeEventListener('input', onInput);\n    el.removeEventListener('paste', handleInputChange);\n  };\n\n  var init = function init() {\n    tests = [];\n    partialPosition = options.mask.length;\n    len = options.mask.length;\n    firstNonMaskPos = null;\n    defs = {\n      '9': '[0-9]',\n      'a': '[A-Za-z]',\n      '*': '[A-Za-z0-9]'\n    };\n\n    var ua = _DomHandler.default.getUserAgent();\n\n    androidChrome = /chrome/i.test(ua) && /android/i.test(ua);\n    var maskTokens = options.mask.split('');\n\n    for (var i = 0; i < maskTokens.length; i++) {\n      var c = maskTokens[i];\n\n      if (c === '?') {\n        len--;\n        partialPosition = i;\n      } else if (defs[c]) {\n        tests.push(new RegExp(defs[c]));\n\n        if (firstNonMaskPos === null) {\n          firstNonMaskPos = tests.length - 1;\n        }\n\n        if (i < partialPosition) {\n          lastRequiredNonMaskPos = tests.length - 1;\n        }\n      } else {\n        tests.push(null);\n      }\n    }\n\n    buffer = [];\n\n    for (var _i = 0; _i < maskTokens.length; _i++) {\n      var _c = maskTokens[_i];\n\n      if (_c !== '?') {\n        if (defs[_c]) buffer.push(getPlaceholder(_i));else buffer.push(_c);\n      }\n    }\n\n    defaultBuffer = buffer.join('');\n  };\n\n  if (el && options.mask) {\n    init();\n    bindEvents();\n  }\n\n  return {\n    init: init,\n    bindEvents: bindEvents,\n    unbindEvents: unbindEvents,\n    updateModel: updateModel,\n    getValue: getValue\n  };\n}"]},"metadata":{},"sourceType":"script"}